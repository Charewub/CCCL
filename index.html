<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cabin Crew Checklist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#DC2626"/>
    <link rel="apple-touch-icon" href="icon-192.png">
    <style>
        body { font-family: 'Inter', 'Kanit', sans-serif; }
        .status-dot { height: 12px; width: 12px; border-radius: 50%; display: inline-block; }
        .online { background-color: #2ecc71; }
        .offline { background-color: #e74c3c; }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto max-w-lg p-2 sm:p-4">
        <header class="bg-red-600 text-white p-4 rounded-lg shadow-md mb-4 flex justify-between items-center">
            <div>
                <h1 class="text-xl sm:text-2xl font-bold">Cabin Crew Checklist</h1>
                <p class="text-xs sm:text-sm opacity-90">Pre-Flight Safety & Procedure</p>
            </div>
            <div class="flex items-center space-x-2 text-right">
                <span id="status-text" class="font-semibold text-sm">Offline</span>
                <span id="status-dot" class="status-dot offline"></span>
            </div>
        </header>

        <form id="checklist-form" class="bg-white p-4 sm:p-6 rounded-lg shadow-md">
            <div class="mb-4">
                <label for="inspector-name" class="block text-gray-700 font-bold mb-2">Inspector Name:</label>
                <select id="inspector-name" name="inspector-name" class="w-full px-3 py-2 border rounded-lg bg-white" required>
                    <option value="" disabled selected>-- Select Name --</option>
                    <option value="Naparin Boonchuaylue">Naparin Boonchuaylue</option>
                    <option value="Khathawut Benjachinsuwan">Khathawut Benjachinsuwan</option>
                    <option value="Parichat Srithongkul">Parichat Srithongkul</option>
                    <option value="Twankorn Chen">Twankorn Chen</option>
                    <option value="Phinlaphat Aphinyaupatham">Phinlaphat Aphinyaupatham</option>
                    <option value="Alisara Usavagovitwong">Alisara Usavagovitwong</option>
                    <option value="Janpen Vorawanitcha">Janpen Vorawanitcha</option>
                    <option value="Adisorn Usmanbaha">Adisorn Usmanbaha</option>
                    <option value="Chotika Totrakool">Chotika Totrakool</option>
                    <option value="Kittitat Chanta-amornlertkul">Kittitat Chanta-amornlertkul</option>
                    <option value="Busabong Promkhuntod">Busabong Promkhuntod</option>
                </select>
            </div>
            <div class="mb-4">
                <label for="flight-number" class="block text-gray-700 font-bold mb-2">Flight Number (Numbers only):</label>
                <input type="number" id="flight-number" name="flight-number" class="w-full px-3 py-2 border rounded-lg" placeholder="e.g., 3001" required>
            </div>
            <hr class="my-6">
            <div id="checklist-items"></div>
            <div class="mt-6">
                <label for="remarks" class="block text-gray-700 font-bold mb-2">Remarks:</label>
                <textarea id="remarks" name="remarks" rows="3" class="w-full px-3 py-2 border rounded-lg"></textarea>
            </div>
            <button type="submit" class="w-full bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 mt-6">
                Save Checklist
            </button>
        </form>
        
        <div class="mt-6">
            <h2 class="text-lg sm:text-xl font-bold text-gray-800">Pending Sync (<span id="pending-count">0</span>)</h2>
            <div id="pending-list" class="mt-2 bg-white p-4 rounded-lg shadow-md max-h-48 overflow-y-auto">
                <p class="text-gray-500 text-center">No pending items.</p>
            </div>
        </div>
    </div>

    <script>
        // *** CONFIGURATION ***
        // You will get these values from the Google Form setup instructions.
        const GOOGLE_FORM_ACTION_URL = "https://docs.google.com/forms/d/e/1FAIpQLSfryHEWS12ZITGVzK1k_xqf6DEtLkz2YAp4_rl7XjMYnEHdeA/formResponse";
        const INPUT_MAPPING = {
            // This is an example, you will replace the 'entry.xxxx' with your actual IDs
            inspectorName: "entry.123456789",
            flightNumber: "entry.234567890",
            emergency_equipment: "entry.345678901",
            medical_kits: "entry.456789012",
            galley_security: "entry.567890123",
            cabin_condition: "entry.678901234",
            safety_cards: "entry.789012345",
            doors_slides: "entry.890123456",
            interphone_pa: "entry.901234567",
            lavatory_checks: "entry.012345678",
            crew_briefing: "entry.112233445",
            cabin_lighting: "entry.223344556",
            remarks: "entry.334455667"
        };

        const CHECKLIST_DEFINITIONS = [
            { id: 'emergency_equipment', label: 'Emergency Equipment (Flashlight, Megaphone) - Serviceable' },
            { id: 'medical_kits', label: 'Medical Kits (First Aid, EMK) - Seals Intact' },
            { id: 'galley_security', label: 'Galley Security (Latches, Carts) - Secured' },
            { id: 'cabin_condition', label: 'Cabin Condition (Overhead Bins, Aisles) - Clear & Secure' },
            { id: 'safety_cards', label: 'Safety Information Cards - Correct Type & Quantity' },
            { id: 'doors_slides', label: 'Doors & Slides - Correct Mode (Armed/Disarmed)' },
            { id: 'interphone_pa', label: 'Interphone & PA System - Functionality Check' },
            { id: 'lavatory_checks', label: 'Lavatory Checks (Smoke Detector, Waste Bin) - Verified' },
            { id: 'crew_briefing', label: 'Pre-Flight Briefing - Acknowledged' },
            { id: 'cabin_lighting', label: 'Cabin Lighting System - Set for Phase of Flight' }
        ];

        // The rest of the script is mostly the same...
        const form = document.getElementById('checklist-form');
        const statusText = document.getElementById('status-text');
        const statusDot = document.getElementById('status-dot');
        const pendingCount = document.getElementById('pending-count');
        const pendingList = document.getElementById('pending-list');
        const checklistItemsContainer = document.getElementById('checklist-items');
        
        function showToast(message, icon = 'success') { /* ... same as before ... */ }
        function generateChecklistItems() { /* ... same as before ... */ }
        function updateOnlineStatus() { /* ... same as before ... */ }
        function saveDataLocally(data) { /* ... same as before ... */ }
        function updatePendingUI() { /* ... same as before ... */ }

        // *** THIS FUNCTION IS UPDATED ***
        async function syncData() {
            if (!navigator.onLine) return;
            let submissions = JSON.parse(localStorage.getItem('pendingSubmissions') || '[]');
            if (submissions.length === 0) return;

            showToast(`Syncing ${submissions.length} item(s)...`, 'info');
            const successfullySynced = [];

            for (const submission of submissions) {
                const formData = new FormData();
                // Map the data from our app to the Google Form entry IDs
                formData.append(INPUT_MAPPING.inspectorName, submission.inspectorName);
                formData.append(INPUT_MAPPING.flightNumber, submission.flightNumber);
                formData.append(INPUT_MAPPING.remarks, submission.remarks);
                CHECKLIST_DEFINITIONS.forEach(item => {
                    formData.append(INPUT_MAPPING[item.id], submission[item.id]);
                });
                
                try {
                    await fetch(GOOGLE_FORM_ACTION_URL, {
                        method: 'POST',
                        body: formData,
                        mode: 'no-cors' // We don't need to read the response from Google Forms
                    });
                    successfullySynced.push(submission);
                } catch (error) {
                    console.error('Sync Error:', error);
                    showToast('Sync failed. Please try again.', 'error');
                    break; 
                }
            }

            if (successfullySynced.length > 0) {
                const newSubmissions = submissions.filter(sub => !successfullySynced.find(s => s.timestamp === sub.timestamp));
                localStorage.setItem('pendingSubmissions', JSON.stringify(newSubmissions));
                updatePendingUI();
                showToast(`Successfully synced ${successfullySynced.length} item(s)!`, 'success');
            }
        }

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const data = { timestamp: new Date().toISOString() };
            for(let [key, value] of formData.entries()) {
                data[key.replace('-','_')] = value;
            }
            CHECKLIST_DEFINITIONS.forEach(item => {
                 data[item.id] = formData.get(item.id);
            });
            saveDataLocally(data);
            form.reset();
        });

        document.addEventListener('DOMContentLoaded', () => { /* ... same as before ... */ });
    </script>
</body>
</html>
